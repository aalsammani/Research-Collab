<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ResearchSync — Collaborative Document Editor</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:ital,wght@0,400;0,500;0,600;1,400;1,500&family=DM+Sans:ital,wght@0,400;0,500;0,600;0,700;1,400&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/docx/8.2.3/docx.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css">
    <style>
        :root {
            --bg-primary: #faf9f7;
            --bg-secondary: #f4f2ef;
            --bg-tertiary: #eae7e2;
            --bg-editor: #ffffff;
            --text-primary: #1a1a1a;
            --text-secondary: #4a4a4a;
            --text-muted: #7a7a7a;
            --accent-primary: #2563eb;
            --accent-secondary: #3b82f6;
            --accent-tertiary: #60a5fa;
            --accent-success: #059669;
            --accent-warning: #d97706;
            --accent-danger: #dc2626;
            --border-light: #e5e2dd;
            --border-medium: #d4d0c8;
            --shadow-sm: 0 1px 2px rgba(0,0,0,0.04);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.06);
            --shadow-lg: 0 8px 24px rgba(0,0,0,0.08);
            --radius-sm: 6px;
            --radius-md: 10px;
            --radius-lg: 16px;
            --transition: 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            
            /* User colors for collaboration */
            --user-1: #2563eb;
            --user-2: #7c3aed;
            --user-3: #059669;
            --user-4: #d97706;
            --user-5: #dc2626;
        }

        [data-theme="dark"] {
            --bg-primary: #121212;
            --bg-secondary: #1a1a1a;
            --bg-tertiary: #242424;
            --bg-editor: #1e1e1e;
            --text-primary: #f0f0f0;
            --text-secondary: #b0b0b0;
            --text-muted: #707070;
            --border-light: #2a2a2a;
            --border-medium: #3a3a3a;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'DM Sans', -apple-system, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            overflow: hidden;
            height: 100vh;
        }

        /* Layout */
        .app-container {
            display: grid;
            grid-template-rows: auto 1fr;
            height: 100vh;
        }

        /* Header */
        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 24px;
            background: var(--bg-editor);
            border-bottom: 1px solid var(--border-light);
            z-index: 100;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            font-size: 18px;
            color: var(--text-primary);
        }

        .logo-icon {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .doc-title {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            background: var(--bg-secondary);
            border-radius: var(--radius-sm);
            border: 1px solid transparent;
            transition: var(--transition);
        }

        .doc-title:hover {
            border-color: var(--border-medium);
        }

        .doc-title input {
            background: transparent;
            border: none;
            outline: none;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-primary);
            width: 200px;
        }

        .doc-status {
            font-size: 11px;
            color: var(--text-muted);
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .doc-status.saved {
            color: var(--accent-success);
        }

        .status-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: currentColor;
        }

        /* Center actions */
        .center-actions {
            display: flex;
            align-items: center;
            gap: 4px;
            background: var(--bg-secondary);
            padding: 4px;
            border-radius: var(--radius-md);
        }

        .mode-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 16px;
            background: transparent;
            border: none;
            border-radius: var(--radius-sm);
            font-size: 13px;
            font-weight: 500;
            color: var(--text-secondary);
            cursor: pointer;
            transition: var(--transition);
        }

        .mode-btn:hover {
            color: var(--text-primary);
        }

        .mode-btn.active {
            background: var(--bg-editor);
            color: var(--accent-primary);
            box-shadow: var(--shadow-sm);
        }

        /* Right actions */
        .right-actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .collaborators {
            display: flex;
            align-items: center;
        }

        .collaborator {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 2px solid var(--bg-editor);
            margin-left: -8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
            color: white;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
        }

        .collaborator:first-child {
            margin-left: 0;
        }

        .collaborator:hover {
            transform: translateY(-2px);
            z-index: 10;
        }

        .collaborator-tooltip {
            position: absolute;
            bottom: -32px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--text-primary);
            color: var(--bg-editor);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: var(--transition);
        }

        .collaborator:hover .collaborator-tooltip {
            opacity: 1;
        }

        .add-collaborator {
            background: var(--bg-tertiary);
            color: var(--text-muted);
            border: 2px dashed var(--border-medium);
        }

        .btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 16px;
            border-radius: var(--radius-sm);
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            border: none;
        }

        .btn-primary {
            background: var(--accent-primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--accent-secondary);
        }

        .btn-secondary {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border: 1px solid var(--border-light);
        }

        .btn-secondary:hover {
            background: var(--bg-tertiary);
        }

        .btn-icon {
            padding: 8px;
            background: transparent;
            color: var(--text-secondary);
        }

        .btn-icon:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        /* Main content */
        .main-content {
            display: grid;
            grid-template-columns: 260px 1fr 320px;
            overflow: hidden;
        }

        /* Sidebar */
        .sidebar {
            background: var(--bg-secondary);
            border-right: 1px solid var(--border-light);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .sidebar-header {
            padding: 16px;
            border-bottom: 1px solid var(--border-light);
        }

        .sidebar-title {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-muted);
            margin-bottom: 12px;
        }

        .file-tree {
            flex: 1;
            overflow-y: auto;
            padding: 8px;
        }

        .file-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: var(--transition);
            font-size: 13px;
            color: var(--text-secondary);
        }

        .file-item:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .file-item.active {
            background: var(--accent-primary);
            color: white;
        }

        .file-item.active .file-icon {
            color: white;
        }

        .file-icon {
            width: 18px;
            height: 18px;
            color: var(--text-muted);
        }

        .folder-item {
            margin-bottom: 4px;
        }

        .folder-header {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .folder-children {
            padding-left: 20px;
        }

        .sidebar-actions {
            padding: 12px;
            border-top: 1px solid var(--border-light);
            display: flex;
            gap: 8px;
        }

        .sidebar-actions .btn {
            flex: 1;
            justify-content: center;
        }

        /* Editor area */
        .editor-area {
            display: flex;
            flex-direction: column;
            overflow: hidden;
            background: var(--bg-editor);
        }

        .editor-toolbar {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 8px 16px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-light);
            flex-wrap: wrap;
        }

        .toolbar-group {
            display: flex;
            align-items: center;
            gap: 2px;
            padding-right: 12px;
            border-right: 1px solid var(--border-light);
            margin-right: 8px;
        }

        .toolbar-group:last-child {
            border-right: none;
            margin-right: 0;
        }

        .toolbar-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            border: none;
            background: transparent;
            border-radius: var(--radius-sm);
            cursor: pointer;
            color: var(--text-secondary);
            transition: var(--transition);
        }

        .toolbar-btn:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .toolbar-btn.active {
            background: var(--accent-primary);
            color: white;
        }

        .toolbar-select {
            padding: 6px 10px;
            border: 1px solid var(--border-light);
            border-radius: var(--radius-sm);
            background: var(--bg-editor);
            font-size: 12px;
            color: var(--text-primary);
            cursor: pointer;
        }

        /* Editor panels */
        .editor-panels {
            flex: 1;
            display: grid;
            overflow: hidden;
        }

        .editor-panels.split {
            grid-template-columns: 1fr 1fr;
        }

        .editor-panel {
            display: flex;
            flex-direction: column;
            overflow: hidden;
            border-right: 1px solid var(--border-light);
        }

        .editor-panel:last-child {
            border-right: none;
        }

        .panel-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 16px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-light);
            font-size: 12px;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .code-editor {
            flex: 1;
            padding: 20px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 14px;
            line-height: 1.7;
            color: var(--text-primary);
            background: var(--bg-editor);
            border: none;
            outline: none;
            resize: none;
            overflow-y: auto;
            tab-size: 2;
        }

        .code-editor::placeholder {
            color: var(--text-muted);
        }

        /* Preview panel */
        .preview-panel {
            padding: 32px 48px;
            overflow-y: auto;
            background: var(--bg-editor);
            font-family: 'Crimson Pro', Georgia, serif;
            font-size: 17px;
            line-height: 1.8;
        }

        .preview-panel h1 {
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 16px;
            color: var(--text-primary);
        }

        .preview-panel h2 {
            font-size: 22px;
            font-weight: 600;
            margin-top: 32px;
            margin-bottom: 12px;
            color: var(--text-primary);
        }

        .preview-panel h3 {
            font-size: 18px;
            font-weight: 600;
            margin-top: 24px;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .preview-panel p {
            margin-bottom: 16px;
            text-align: justify;
        }

        .preview-panel .math-block {
            margin: 24px 0;
            text-align: center;
            overflow-x: auto;
        }

        /* Word editor */
        .word-editor {
            flex: 1;
            padding: 48px 64px;
            overflow-y: auto;
            background: var(--bg-editor);
        }

        .word-content {
            max-width: 700px;
            margin: 0 auto;
            min-height: 100%;
            font-family: 'Crimson Pro', Georgia, serif;
            font-size: 16px;
            line-height: 1.8;
            outline: none;
        }

        .word-content:focus {
            outline: none;
        }

        .word-content h1 {
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 16px;
        }

        .word-content h2 {
            font-size: 22px;
            font-weight: 600;
            margin-top: 24px;
            margin-bottom: 12px;
        }

        .word-content p {
            margin-bottom: 12px;
        }

        /* Right panel - Comments & Chat */
        .right-panel {
            background: var(--bg-secondary);
            border-left: 1px solid var(--border-light);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .panel-tabs {
            display: flex;
            border-bottom: 1px solid var(--border-light);
        }

        .panel-tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            font-size: 13px;
            font-weight: 500;
            color: var(--text-secondary);
            background: transparent;
            border: none;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
        }

        .panel-tab:hover {
            color: var(--text-primary);
        }

        .panel-tab.active {
            color: var(--accent-primary);
        }

        .panel-tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--accent-primary);
        }

        .tab-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 18px;
            height: 18px;
            padding: 0 5px;
            background: var(--accent-primary);
            color: white;
            border-radius: 9px;
            font-size: 10px;
            font-weight: 600;
            margin-left: 6px;
        }

        .panel-content {
            flex: 1;
            overflow-y: auto;
            display: none;
        }

        .panel-content.active {
            display: flex;
            flex-direction: column;
        }

        /* Comments */
        .comments-list {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
        }

        .comment-card {
            background: var(--bg-editor);
            border-radius: var(--radius-md);
            padding: 14px;
            margin-bottom: 12px;
            border: 1px solid var(--border-light);
            transition: var(--transition);
        }

        .comment-card:hover {
            box-shadow: var(--shadow-md);
        }

        .comment-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .comment-avatar {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: 600;
            color: white;
        }

        .comment-meta {
            flex: 1;
        }

        .comment-author {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .comment-time {
            font-size: 11px;
            color: var(--text-muted);
        }

        .comment-selection {
            background: var(--bg-secondary);
            padding: 8px 12px;
            border-radius: var(--radius-sm);
            font-size: 12px;
            color: var(--text-secondary);
            font-style: italic;
            margin-bottom: 10px;
            border-left: 3px solid var(--accent-primary);
        }

        .comment-text {
            font-size: 13px;
            color: var(--text-primary);
            line-height: 1.5;
        }

        .comment-actions {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }

        .comment-action {
            font-size: 12px;
            color: var(--text-muted);
            background: transparent;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
            transition: var(--transition);
        }

        .comment-action:hover {
            color: var(--accent-primary);
        }

        .add-comment {
            padding: 16px;
            border-top: 1px solid var(--border-light);
        }

        .comment-input-wrapper {
            display: flex;
            gap: 8px;
        }

        .comment-input {
            flex: 1;
            padding: 10px 14px;
            border: 1px solid var(--border-light);
            border-radius: var(--radius-md);
            font-size: 13px;
            background: var(--bg-editor);
            color: var(--text-primary);
            resize: none;
            outline: none;
            min-height: 80px;
        }

        .comment-input:focus {
            border-color: var(--accent-primary);
        }

        /* Chat */
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .chat-message {
            display: flex;
            gap: 10px;
            animation: slideIn 0.2s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .chat-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
            color: white;
            flex-shrink: 0;
        }

        .chat-bubble {
            flex: 1;
        }

        .chat-sender {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .chat-text {
            background: var(--bg-editor);
            padding: 10px 14px;
            border-radius: var(--radius-md);
            font-size: 13px;
            color: var(--text-primary);
            border: 1px solid var(--border-light);
        }

        .chat-time {
            font-size: 10px;
            color: var(--text-muted);
            margin-top: 4px;
        }

        .chat-input-area {
            padding: 16px;
            border-top: 1px solid var(--border-light);
        }

        .chat-input-wrapper {
            display: flex;
            gap: 8px;
            background: var(--bg-editor);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-md);
            padding: 4px;
        }

        .chat-input {
            flex: 1;
            padding: 8px 12px;
            border: none;
            background: transparent;
            font-size: 13px;
            color: var(--text-primary);
            outline: none;
        }

        .chat-send {
            padding: 8px 14px;
            background: var(--accent-primary);
            color: white;
            border: none;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: var(--transition);
        }

        .chat-send:hover {
            background: var(--accent-secondary);
        }

        /* Version History */
        .versions-list {
            padding: 16px;
        }

        .version-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 12px;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: var(--transition);
            margin-bottom: 8px;
        }

        .version-item:hover {
            background: var(--bg-tertiary);
        }

        .version-marker {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--accent-primary);
            margin-top: 4px;
            flex-shrink: 0;
        }

        .version-info {
            flex: 1;
        }

        .version-title {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 2px;
        }

        .version-meta {
            font-size: 11px;
            color: var(--text-muted);
        }

        /* Modals */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: var(--bg-editor);
            border-radius: var(--radius-lg);
            width: 100%;
            max-width: 480px;
            max-height: 90vh;
            overflow: hidden;
            transform: scale(0.95);
            transition: var(--transition);
        }

        .modal-overlay.active .modal {
            transform: scale(1);
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 24px;
            border-bottom: 1px solid var(--border-light);
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .modal-close {
            width: 32px;
            height: 32px;
            border: none;
            background: transparent;
            border-radius: var(--radius-sm);
            cursor: pointer;
            color: var(--text-muted);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .modal-close:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        .modal-body {
            padding: 24px;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            padding: 16px 24px;
            border-top: 1px solid var(--border-light);
        }

        /* Form elements */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 13px;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 6px;
        }

        .form-input {
            width: 100%;
            padding: 10px 14px;
            border: 1px solid var(--border-light);
            border-radius: var(--radius-sm);
            font-size: 14px;
            background: var(--bg-editor);
            color: var(--text-primary);
            outline: none;
            transition: var(--transition);
        }

        .form-input:focus {
            border-color: var(--accent-primary);
        }

        .form-hint {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 6px;
        }

        /* Upload area */
        .upload-area {
            border: 2px dashed var(--border-medium);
            border-radius: var(--radius-md);
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .upload-area:hover {
            border-color: var(--accent-primary);
            background: var(--bg-secondary);
        }

        .upload-icon {
            width: 48px;
            height: 48px;
            margin: 0 auto 16px;
            color: var(--text-muted);
        }

        .upload-text {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .upload-hint {
            font-size: 12px;
            color: var(--text-muted);
        }

        /* Toast notifications */
        .toast-container {
            position: fixed;
            bottom: 24px;
            right: 24px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            z-index: 1001;
        }

        .toast {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 18px;
            background: var(--text-primary);
            color: var(--bg-editor);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-lg);
            animation: toastIn 0.3s ease;
        }

        @keyframes toastIn {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .toast-icon {
            width: 20px;
            height: 20px;
        }

        .toast-message {
            font-size: 13px;
            font-weight: 500;
        }

        /* Typing indicator */
        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            font-size: 12px;
            color: var(--text-muted);
        }

        .typing-dots {
            display: flex;
            gap: 4px;
        }

        .typing-dot {
            width: 6px;
            height: 6px;
            background: var(--text-muted);
            border-radius: 50%;
            animation: typingBounce 1s infinite;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typingBounce {
            0%, 60%, 100% {
                transform: translateY(0);
            }
            30% {
                transform: translateY(-4px);
            }
        }

        /* Cursor indicator for collaboration */
        .remote-cursor {
            position: absolute;
            width: 2px;
            height: 1.2em;
            animation: cursorBlink 1s infinite;
            pointer-events: none;
        }

        @keyframes cursorBlink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        .remote-cursor-label {
            position: absolute;
            top: -20px;
            left: 0;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 500;
            color: white;
            white-space: nowrap;
        }

        /* Syntax highlighting classes */
        .tex-command { color: #2563eb; }
        .tex-bracket { color: #7c3aed; }
        .tex-comment { color: #6b7280; font-style: italic; }
        .tex-math { color: #059669; }
        .tex-environment { color: #d97706; }

        /* Empty state */
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 48px;
            text-align: center;
        }

        .empty-icon {
            width: 64px;
            height: 64px;
            color: var(--text-muted);
            margin-bottom: 16px;
        }

        .empty-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .empty-text {
            font-size: 14px;
            color: var(--text-muted);
            max-width: 280px;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 220px 1fr 280px;
            }
        }

        @media (max-width: 900px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .sidebar, .right-panel {
                display: none;
            }
        }

        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-medium);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-muted);
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="logo-section">
                <div class="logo">
                    <div class="logo-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14 2 14 8 20 8"/>
                            <line x1="16" y1="13" x2="8" y2="13"/>
                            <line x1="16" y1="17" x2="8" y2="17"/>
                            <polyline points="10 9 9 9 8 9"/>
                        </svg>
                    </div>
                    ResearchSync
                </div>
                <div class="doc-title">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                        <polyline points="14 2 14 8 20 8"/>
                    </svg>
                    <input type="text" id="docTitle" value="Untitled Research Paper" spellcheck="false">
                </div>
                <div class="doc-status saved">
                    <span class="status-dot"></span>
                    <span id="saveStatus">All changes saved</span>
                </div>
            </div>

            <div class="center-actions">
                <button class="mode-btn active" data-mode="latex" onclick="switchMode('latex')">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="16 18 22 12 16 6"/>
                        <polyline points="8 6 2 12 8 18"/>
                    </svg>
                    LaTeX Editor
                </button>
                <button class="mode-btn" data-mode="word" onclick="switchMode('word')">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                        <polyline points="14 2 14 8 20 8"/>
                        <line x1="16" y1="13" x2="8" y2="13"/>
                        <line x1="16" y1="17" x2="8" y2="17"/>
                    </svg>
                    Word Editor
                </button>
            </div>

            <div class="right-actions">
                <div class="collaborators">
                    <div class="collaborator" style="background: var(--user-1)">
                        JD
                        <span class="collaborator-tooltip">John Doe (you)</span>
                    </div>
                    <div class="collaborator" style="background: var(--user-2)">
                        SK
                        <span class="collaborator-tooltip">Sarah Kim</span>
                    </div>
                    <div class="collaborator" style="background: var(--user-3)">
                        MR
                        <span class="collaborator-tooltip">Michael Roberts</span>
                    </div>
                    <div class="collaborator add-collaborator" onclick="showModal('share')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="12" y1="5" x2="12" y2="19"/>
                            <line x1="5" y1="12" x2="19" y2="12"/>
                        </svg>
                    </div>
                </div>
                <button class="btn btn-icon" onclick="toggleTheme()" title="Toggle theme">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"/>
                        <line x1="12" y1="1" x2="12" y2="3"/>
                        <line x1="12" y1="21" x2="12" y2="23"/>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
                        <line x1="1" y1="12" x2="3" y2="12"/>
                        <line x1="21" y1="12" x2="23" y2="12"/>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
                    </svg>
                </button>
                <button class="btn btn-secondary" onclick="showModal('export')">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                        <polyline points="7 10 12 15 17 10"/>
                        <line x1="12" y1="15" x2="12" y2="3"/>
                    </svg>
                    Export
                </button>
                <button class="btn btn-primary" onclick="showModal('share')">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="18" cy="5" r="3"/>
                        <circle cx="6" cy="12" r="3"/>
                        <circle cx="18" cy="19" r="3"/>
                        <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/>
                        <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/>
                    </svg>
                    Share
                </button>
            </div>
        </header>

        <!-- Main content -->
        <main class="main-content">
            <!-- Sidebar -->
            <aside class="sidebar">
                <div class="sidebar-header">
                    <div class="sidebar-title">Project Files</div>
                </div>
                <div class="file-tree" id="fileTree">
                    <div class="folder-item">
                        <div class="folder-header">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/>
                            </svg>
                            Research Project
                        </div>
                        <div class="folder-children">
                            <div class="file-item active" data-file="main.tex" onclick="openFile('main.tex')">
                                <svg class="file-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <polyline points="16 18 22 12 16 6"/>
                                    <polyline points="8 6 2 12 8 18"/>
                                </svg>
                                main.tex
                            </div>
                            <div class="file-item" data-file="introduction.tex" onclick="openFile('introduction.tex')">
                                <svg class="file-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <polyline points="16 18 22 12 16 6"/>
                                    <polyline points="8 6 2 12 8 18"/>
                                </svg>
                                introduction.tex
                            </div>
                            <div class="file-item" data-file="methodology.tex" onclick="openFile('methodology.tex')">
                                <svg class="file-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <polyline points="16 18 22 12 16 6"/>
                                    <polyline points="8 6 2 12 8 18"/>
                                </svg>
                                methodology.tex
                            </div>
                            <div class="file-item" data-file="results.tex" onclick="openFile('results.tex')">
                                <svg class="file-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <polyline points="16 18 22 12 16 6"/>
                                    <polyline points="8 6 2 12 8 18"/>
                                </svg>
                                results.tex
                            </div>
                            <div class="file-item" data-file="references.bib" onclick="openFile('references.bib')">
                                <svg class="file-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
                                    <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
                                </svg>
                                references.bib
                            </div>
                        </div>
                    </div>
                </div>
                <div class="sidebar-actions">
                    <button class="btn btn-secondary" onclick="createNewFile()">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="12" y1="5" x2="12" y2="19"/>
                            <line x1="5" y1="12" x2="19" y2="12"/>
                        </svg>
                        New File
                    </button>
                    <button class="btn btn-secondary" onclick="showModal('upload')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                            <polyline points="17 8 12 3 7 8"/>
                            <line x1="12" y1="3" x2="12" y2="15"/>
                        </svg>
                        Upload
                    </button>
                </div>
            </aside>

            <!-- Editor Area -->
            <section class="editor-area" id="editorArea">
                <!-- LaTeX Editor -->
                <div id="latexEditor" class="latex-mode">
                    <div class="editor-toolbar">
                        <div class="toolbar-group">
                            <button class="toolbar-btn" onclick="insertLatex('\\textbf{', '}')" title="Bold">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M6 4h8a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z"/>
                                    <path d="M6 12h9a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z"/>
                                </svg>
                            </button>
                            <button class="toolbar-btn" onclick="insertLatex('\\textit{', '}')" title="Italic">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <line x1="19" y1="4" x2="10" y2="4"/>
                                    <line x1="14" y1="20" x2="5" y2="20"/>
                                    <line x1="15" y1="4" x2="9" y2="20"/>
                                </svg>
                            </button>
                            <button class="toolbar-btn" onclick="insertLatex('\\underline{', '}')" title="Underline">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M6 3v7a6 6 0 0 0 6 6 6 6 0 0 0 6-6V3"/>
                                    <line x1="4" y1="21" x2="20" y2="21"/>
                                </svg>
                            </button>
                        </div>
                        <div class="toolbar-group">
                            <button class="toolbar-btn" onclick="insertLatex('\\section{', '}')" title="Section">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <line x1="4" y1="9" x2="20" y2="9"/>
                                    <line x1="4" y1="15" x2="20" y2="15"/>
                                    <line x1="10" y1="3" x2="8" y2="21"/>
                                    <line x1="16" y1="3" x2="14" y2="21"/>
                                </svg>
                            </button>
                            <button class="toolbar-btn" onclick="insertLatex('\\subsection{', '}')" title="Subsection">H2</button>
                            <button class="toolbar-btn" onclick="insertLatex('\\subsubsection{', '}')" title="Subsubsection">H3</button>
                        </div>
                        <div class="toolbar-group">
                            <button class="toolbar-btn" onclick="insertLatex('$', '$')" title="Inline Math">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M4 7h3l2 10h6l2-10h3"/>
                                </svg>
                            </button>
                            <button class="toolbar-btn" onclick="insertLatex('\\[\n', '\n\\]')" title="Display Math">∑</button>
                            <button class="toolbar-btn" onclick="insertLatex('\\frac{', '}{}')" title="Fraction">½</button>
                            <button class="toolbar-btn" onclick="insertLatex('\\sqrt{', '}')" title="Square Root">√</button>
                        </div>
                        <div class="toolbar-group">
                            <button class="toolbar-btn" onclick="insertLatex('\\begin{equation}\n', '\n\\end{equation}')" title="Equation">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                                </svg>
                            </button>
                            <button class="toolbar-btn" onclick="insertLatex('\\begin{itemize}\n  \\item ', '\n\\end{itemize}')" title="Bullet List">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <line x1="8" y1="6" x2="21" y2="6"/>
                                    <line x1="8" y1="12" x2="21" y2="12"/>
                                    <line x1="8" y1="18" x2="21" y2="18"/>
                                    <circle cx="4" cy="6" r="1" fill="currentColor"/>
                                    <circle cx="4" cy="12" r="1" fill="currentColor"/>
                                    <circle cx="4" cy="18" r="1" fill="currentColor"/>
                                </svg>
                            </button>
                            <button class="toolbar-btn" onclick="insertLatex('\\begin{enumerate}\n  \\item ', '\n\\end{enumerate}')" title="Numbered List">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <line x1="10" y1="6" x2="21" y2="6"/>
                                    <line x1="10" y1="12" x2="21" y2="12"/>
                                    <line x1="10" y1="18" x2="21" y2="18"/>
                                    <text x="4" y="8" font-size="8" fill="currentColor">1</text>
                                    <text x="4" y="14" font-size="8" fill="currentColor">2</text>
                                    <text x="4" y="20" font-size="8" fill="currentColor">3</text>
                                </svg>
                            </button>
                        </div>
                        <div class="toolbar-group">
                            <button class="toolbar-btn" onclick="insertLatex('\\cite{', '}')" title="Citation">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
                                    <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
                                </svg>
                            </button>
                            <button class="toolbar-btn" onclick="insertLatex('\\ref{', '}')" title="Reference">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/>
                                    <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/>
                                </svg>
                            </button>
                            <button class="toolbar-btn" onclick="insertLatex('\\label{', '}')" title="Label">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"/>
                                    <line x1="7" y1="7" x2="7.01" y2="7"/>
                                </svg>
                            </button>
                        </div>
                        <div class="toolbar-group">
                            <button class="toolbar-btn" onclick="insertLatex('\\begin{figure}[h]\n  \\centering\n  \\includegraphics[width=0.8\\textwidth]{', '}\n  \\caption{Caption}\n  \\label{fig:label}\n\\end{figure}')" title="Figure">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                                    <circle cx="8.5" cy="8.5" r="1.5"/>
                                    <polyline points="21 15 16 10 5 21"/>
                                </svg>
                            </button>
                            <button class="toolbar-btn" onclick="insertLatex('\\begin{table}[h]\n  \\centering\n  \\begin{tabular}{|c|c|c|}\n    \\hline\n    ', ' & & \\\\\n    \\hline\n  \\end{tabular}\n  \\caption{Caption}\n  \\label{tab:label}\n\\end{table}')" title="Table">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                                    <line x1="3" y1="9" x2="21" y2="9"/>
                                    <line x1="3" y1="15" x2="21" y2="15"/>
                                    <line x1="9" y1="3" x2="9" y2="21"/>
                                    <line x1="15" y1="3" x2="15" y2="21"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div class="editor-panels split">
                        <div class="editor-panel">
                            <div class="panel-header">
                                <span>Source Code</span>
                                <span id="lineInfo">Line 1, Column 1</span>
                            </div>
                            <textarea class="code-editor" id="texEditor" placeholder="Start writing your LaTeX document..." spellcheck="false"></textarea>
                        </div>
                        <div class="editor-panel">
                            <div class="panel-header">
                                <span>Preview</span>
                                <button class="toolbar-btn" onclick="togglePreviewMode()" title="Toggle split view">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                                        <line x1="12" y1="3" x2="12" y2="21"/>
                                    </svg>
                                </button>
                            </div>
                            <div class="preview-panel" id="texPreview"></div>
                        </div>
                    </div>
                </div>

                <!-- Word Editor -->
                <div id="wordEditor" class="word-mode" style="display: none;">
                    <div class="editor-toolbar">
                        <div class="toolbar-group">
                            <button class="toolbar-btn" onclick="formatWord('bold')" title="Bold">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M6 4h8a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z"/>
                                    <path d="M6 12h9a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z"/>
                                </svg>
                            </button>
                            <button class="toolbar-btn" onclick="formatWord('italic')" title="Italic">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <line x1="19" y1="4" x2="10" y2="4"/>
                                    <line x1="14" y1="20" x2="5" y2="20"/>
                                    <line x1="15" y1="4" x2="9" y2="20"/>
                                </svg>
                            </button>
                            <button class="toolbar-btn" onclick="formatWord('underline')" title="Underline">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M6 3v7a6 6 0 0 0 6 6 6 6 0 0 0 6-6V3"/>
                                    <line x1="4" y1="21" x2="20" y2="21"/>
                                </svg>
                            </button>
                            <button class="toolbar-btn" onclick="formatWord('strikeThrough')" title="Strikethrough">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <line x1="4" y1="12" x2="20" y2="12"/>
                                    <path d="M17.5 6H9a3.5 3.5 0 0 0 0 7"/>
                                    <path d="M8 18h7.5a3.5 3.5 0 0 0 0-7"/>
                                </svg>
                            </button>
                        </div>
                        <div class="toolbar-group">
                            <select class="toolbar-select" onchange="formatWord('formatBlock', this.value)">
                                <option value="p">Paragraph</option>
                                <option value="h1">Heading 1</option>
                                <option value="h2">Heading 2</option>
                                <option value="h3">Heading 3</option>
                                <option value="blockquote">Quote</option>
                            </select>
                            <select class="toolbar-select" onchange="formatWord('fontSize', this.value)">
                                <option value="3">Normal</option>
                                <option value="1">Small</option>
                                <option value="5">Large</option>
                                <option value="7">Huge</option>
                            </select>
                        </div>
                        <div class="toolbar-group">
                            <button class="toolbar-btn" onclick="formatWord('justifyLeft')" title="Align Left">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <line x1="17" y1="10" x2="3" y2="10"/>
                                    <line x1="21" y1="6" x2="3" y2="6"/>
                                    <line x1="21" y1="14" x2="3" y2="14"/>
                                    <line x1="17" y1="18" x2="3" y2="18"/>
                                </svg>
                            </button>
                            <button class="toolbar-btn" onclick="formatWord('justifyCenter')" title="Align Center">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <line x1="18" y1="10" x2="6" y2="10"/>
                                    <line x1="21" y1="6" x2="3" y2="6"/>
                                    <line x1="21" y1="14" x2="3" y2="14"/>
                                    <line x1="18" y1="18" x2="6" y2="18"/>
                                </svg>
                            </button>
                            <button class="toolbar-btn" onclick="formatWord('justifyRight')" title="Align Right">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <line x1="21" y1="10" x2="7" y2="10"/>
                                    <line x1="21" y1="6" x2="3" y2="6"/>
                                    <line x1="21" y1="14" x2="3" y2="14"/>
                                    <line x1="21" y1="18" x2="7" y2="18"/>
                                </svg>
                            </button>
                            <button class="toolbar-btn" onclick="formatWord('justifyFull')" title="Justify">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <line x1="21" y1="10" x2="3" y2="10"/>
                                    <line x1="21" y1="6" x2="3" y2="6"/>
                                    <line x1="21" y1="14" x2="3" y2="14"/>
                                    <line x1="21" y1="18" x2="3" y2="18"/>
                                </svg>
                            </button>
                        </div>
                        <div class="toolbar-group">
                            <button class="toolbar-btn" onclick="formatWord('insertUnorderedList')" title="Bullet List">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <line x1="8" y1="6" x2="21" y2="6"/>
                                    <line x1="8" y1="12" x2="21" y2="12"/>
                                    <line x1="8" y1="18" x2="21" y2="18"/>
                                    <circle cx="4" cy="6" r="1" fill="currentColor"/>
                                    <circle cx="4" cy="12" r="1" fill="currentColor"/>
                                    <circle cx="4" cy="18" r="1" fill="currentColor"/>
                                </svg>
                            </button>
                            <button class="toolbar-btn" onclick="formatWord('insertOrderedList')" title="Numbered List">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <line x1="10" y1="6" x2="21" y2="6"/>
                                    <line x1="10" y1="12" x2="21" y2="12"/>
                                    <line x1="10" y1="18" x2="21" y2="18"/>
                                    <text x="4" y="8" font-size="8" fill="currentColor">1</text>
                                    <text x="4" y="14" font-size="8" fill="currentColor">2</text>
                                    <text x="4" y="20" font-size="8" fill="currentColor">3</text>
                                </svg>
                            </button>
                            <button class="toolbar-btn" onclick="formatWord('indent')" title="Indent">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <polyline points="3 8 7 12 3 16"/>
                                    <line x1="21" y1="12" x2="11" y2="12"/>
                                    <line x1="21" y1="6" x2="11" y2="6"/>
                                    <line x1="21" y1="18" x2="11" y2="18"/>
                                </svg>
                            </button>
                            <button class="toolbar-btn" onclick="formatWord('outdent')" title="Outdent">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <polyline points="7 8 3 12 7 16"/>
                                    <line x1="21" y1="12" x2="11" y2="12"/>
                                    <line x1="21" y1="6" x2="11" y2="6"/>
                                    <line x1="21" y1="18" x2="11" y2="18"/>
                                </svg>
                            </button>
                        </div>
                        <div class="toolbar-group">
                            <button class="toolbar-btn" onclick="insertLink()" title="Insert Link">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/>
                                    <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/>
                                </svg>
                            </button>
                            <button class="toolbar-btn" onclick="formatWord('removeFormat')" title="Clear Formatting">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <line x1="18" y1="6" x2="6" y2="18"/>
                                    <line x1="6" y1="6" x2="18" y2="18"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div class="word-editor">
                        <div class="word-content" id="wordContent" contenteditable="true">
                            <h1>Research Paper Title</h1>
                            <p>Start writing your research document here. This editor supports rich text formatting, and you can export your work to Microsoft Word format.</p>
                            <h2>Introduction</h2>
                            <p>Provide background information and context for your research. Explain the problem you're addressing and why it matters.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Right Panel -->
            <aside class="right-panel">
                <div class="panel-tabs">
                    <button class="panel-tab active" onclick="switchPanelTab('comments')">
                        Comments
                        <span class="tab-badge" id="commentCount">3</span>
                    </button>
                    <button class="panel-tab" onclick="switchPanelTab('chat')">
                        Chat
                        <span class="tab-badge" id="unreadCount">2</span>
                    </button>
                    <button class="panel-tab" onclick="switchPanelTab('versions')">
                        History
                    </button>
                </div>

                <!-- Comments Panel -->
                <div class="panel-content active" id="commentsPanel">
                    <div class="comments-list" id="commentsList">
                        <div class="comment-card">
                            <div class="comment-header">
                                <div class="comment-avatar" style="background: var(--user-2)">SK</div>
                                <div class="comment-meta">
                                    <div class="comment-author">Sarah Kim</div>
                                    <div class="comment-time">2 hours ago</div>
                                </div>
                            </div>
                            <div class="comment-selection">"...the methodology section needs..."</div>
                            <div class="comment-text">Could we add more detail about the statistical methods used? I think reviewers will ask about this.</div>
                            <div class="comment-actions">
                                <button class="comment-action">
                                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/>
                                    </svg>
                                    Reply
                                </button>
                                <button class="comment-action">
                                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <polyline points="20 6 9 17 4 12"/>
                                    </svg>
                                    Resolve
                                </button>
                            </div>
                        </div>
                        <div class="comment-card">
                            <div class="comment-header">
                                <div class="comment-avatar" style="background: var(--user-3)">MR</div>
                                <div class="comment-meta">
                                    <div class="comment-author">Michael Roberts</div>
                                    <div class="comment-time">5 hours ago</div>
                                </div>
                            </div>
                            <div class="comment-selection">"...Figure 3 shows..."</div>
                            <div class="comment-text">The figure caption should mention the p-value. Also, consider using a different color scheme for accessibility.</div>
                            <div class="comment-actions">
                                <button class="comment-action">
                                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/>
                                    </svg>
                                    Reply
                                </button>
                                <button class="comment-action">
                                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <polyline points="20 6 9 17 4 12"/>
                                    </svg>
                                    Resolve
                                </button>
                            </div>
                        </div>
                        <div class="comment-card">
                            <div class="comment-header">
                                <div class="comment-avatar" style="background: var(--user-1)">JD</div>
                                <div class="comment-meta">
                                    <div class="comment-author">John Doe</div>
                                    <div class="comment-time">1 day ago</div>
                                </div>
                            </div>
                            <div class="comment-text">@Sarah @Michael - I've added the new references to the bibliography. Please review when you get a chance.</div>
                            <div class="comment-actions">
                                <button class="comment-action">
                                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/>
                                    </svg>
                                    Reply
                                </button>
                                <button class="comment-action">
                                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <polyline points="20 6 9 17 4 12"/>
                                    </svg>
                                    Resolve
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="add-comment">
                        <textarea class="comment-input" placeholder="Add a comment... (Select text to quote)"></textarea>
                        <div style="display: flex; justify-content: flex-end; margin-top: 8px;">
                            <button class="btn btn-primary" onclick="addComment()">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <line x1="22" y1="2" x2="11" y2="13"/>
                                    <polygon points="22 2 15 22 11 13 2 9 22 2"/>
                                </svg>
                                Comment
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Chat Panel -->
                <div class="panel-content" id="chatPanel">
                    <div class="chat-messages" id="chatMessages">
                        <div class="chat-message">
                            <div class="chat-avatar" style="background: var(--user-2)">SK</div>
                            <div class="chat-bubble">
                                <div class="chat-sender">Sarah Kim</div>
                                <div class="chat-text">Hey team! I've finished the literature review section. Could you take a look?</div>
                                <div class="chat-time">10:32 AM</div>
                            </div>
                        </div>
                        <div class="chat-message">
                            <div class="chat-avatar" style="background: var(--user-3)">MR</div>
                            <div class="chat-bubble">
                                <div class="chat-sender">Michael Roberts</div>
                                <div class="chat-text">Sure! I'll review it this afternoon. Also, I found some interesting papers we might want to cite.</div>
                                <div class="chat-time">10:45 AM</div>
                            </div>
                        </div>
                        <div class="chat-message">
                            <div class="chat-avatar" style="background: var(--user-1)">JD</div>
                            <div class="chat-bubble">
                                <div class="chat-sender">John Doe</div>
                                <div class="chat-text">Great work everyone! Let's aim to have a complete draft by Friday.</div>
                                <div class="chat-time">11:02 AM</div>
                            </div>
                        </div>
                    </div>
                    <div class="typing-indicator" id="typingIndicator" style="display: none;">
                        <div class="typing-dots">
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                        </div>
                        <span>Sarah is typing...</span>
                    </div>
                    <div class="chat-input-area">
                        <div class="chat-input-wrapper">
                            <input type="text" class="chat-input" id="chatInput" placeholder="Type a message..." onkeypress="handleChatKeypress(event)">
                            <button class="chat-send" onclick="sendChatMessage()">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <line x1="22" y1="2" x2="11" y2="13"/>
                                    <polygon points="22 2 15 22 11 13 2 9 22 2"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Versions Panel -->
                <div class="panel-content" id="versionsPanel">
                    <div class="versions-list">
                        <div class="version-item">
                            <div class="version-marker"></div>
                            <div class="version-info">
                                <div class="version-title">Current version</div>
                                <div class="version-meta">Auto-saved • Just now</div>
                            </div>
                        </div>
                        <div class="version-item">
                            <div class="version-marker" style="background: var(--user-2)"></div>
                            <div class="version-info">
                                <div class="version-title">Added methodology details</div>
                                <div class="version-meta">Sarah Kim • 2 hours ago</div>
                            </div>
                        </div>
                        <div class="version-item">
                            <div class="version-marker" style="background: var(--user-3)"></div>
                            <div class="version-info">
                                <div class="version-title">Updated figures</div>
                                <div class="version-meta">Michael Roberts • 5 hours ago</div>
                            </div>
                        </div>
                        <div class="version-item">
                            <div class="version-marker" style="background: var(--user-1)"></div>
                            <div class="version-info">
                                <div class="version-title">Initial draft</div>
                                <div class="version-meta">John Doe • Yesterday</div>
                            </div>
                        </div>
                        <div class="version-item">
                            <div class="version-marker" style="background: var(--text-muted)"></div>
                            <div class="version-info">
                                <div class="version-title">Document created</div>
                                <div class="version-meta">John Doe • 3 days ago</div>
                            </div>
                        </div>
                    </div>
                </div>
            </aside>
        </main>
    </div>

    <!-- Share Modal -->
    <div class="modal-overlay" id="shareModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Share Document</h3>
                <button class="modal-close" onclick="hideModal('share')">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Invite collaborators</label>
                    <input type="email" class="form-input" placeholder="Enter email addresses">
                    <p class="form-hint">Separate multiple emails with commas</p>
                </div>
                <div class="form-group">
                    <label class="form-label">Permission</label>
                    <select class="form-input">
                        <option>Can edit</option>
                        <option>Can comment</option>
                        <option>Can view</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Share link</label>
                    <div style="display: flex; gap: 8px;">
                        <input type="text" class="form-input" value="https://researchsync.io/doc/abc123" readonly style="flex: 1;">
                        <button class="btn btn-secondary" onclick="copyLink()">Copy</button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="hideModal('share')">Cancel</button>
                <button class="btn btn-primary" onclick="shareDocument()">Send Invite</button>
            </div>
        </div>
    </div>

    <!-- Export Modal -->
    <div class="modal-overlay" id="exportModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Export Document</h3>
                <button class="modal-close" onclick="hideModal('export')">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Export format</label>
                    <select class="form-input" id="exportFormat">
                        <option value="tex">LaTeX (.tex)</option>
                        <option value="pdf">PDF Document (.pdf)</option>
                        <option value="docx">Word Document (.docx)</option>
                        <option value="html">HTML (.html)</option>
                        <option value="md">Markdown (.md)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Include</label>
                    <div style="display: flex; flex-direction: column; gap: 8px; margin-top: 8px;">
                        <label style="display: flex; align-items: center; gap: 8px; font-size: 13px; cursor: pointer;">
                            <input type="checkbox" checked> Comments
                        </label>
                        <label style="display: flex; align-items: center; gap: 8px; font-size: 13px; cursor: pointer;">
                            <input type="checkbox" checked> Version history
                        </label>
                        <label style="display: flex; align-items: center; gap: 8px; font-size: 13px; cursor: pointer;">
                            <input type="checkbox"> Track changes
                        </label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="hideModal('export')">Cancel</button>
                <button class="btn btn-primary" onclick="exportDocument()">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                        <polyline points="7 10 12 15 17 10"/>
                        <line x1="12" y1="15" x2="12" y2="3"/>
                    </svg>
                    Export
                </button>
            </div>
        </div>
    </div>

    <!-- Upload Modal -->
    <div class="modal-overlay" id="uploadModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Upload File</h3>
                <button class="modal-close" onclick="hideModal('upload')">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="upload-area" onclick="document.getElementById('fileInput').click()">
                    <svg class="upload-icon" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                        <polyline points="17 8 12 3 7 8"/>
                        <line x1="12" y1="3" x2="12" y2="15"/>
                    </svg>
                    <p class="upload-text">Click to upload or drag and drop</p>
                    <p class="upload-hint">Supports .tex, .docx, .bib, .pdf files</p>
                </div>
                <input type="file" id="fileInput" style="display: none;" accept=".tex,.docx,.bib,.pdf" onchange="handleFileUpload(event)">
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script>
        // Application State
        const state = {
            currentMode: 'latex',
            currentFile: 'main.tex',
            files: {
                'main.tex': `\\documentclass{article}
\\usepackage{amsmath}
\\usepackage{graphicx}
\\usepackage{hyperref}

\\title{Research Paper Title}
\\author{John Doe \\and Sarah Kim \\and Michael Roberts}
\\date{\\today}

\\begin{document}

\\maketitle

\\begin{abstract}
This paper presents a comprehensive analysis of our research findings. We demonstrate novel approaches to solving complex problems in our domain of study.
\\end{abstract}

\\section{Introduction}
The study of complex systems has gained significant attention in recent years. Our research contributes to this growing body of knowledge by introducing new methodologies and frameworks.

\\subsection{Background}
Previous work in this area has established foundational principles that guide our approach. Key contributions include \\cite{smith2020} and \\cite{jones2021}.

\\subsection{Motivation}
The primary motivation for this research stems from the need to address gaps in existing literature. Specifically, we aim to:
\\begin{itemize}
    \\item Develop more efficient algorithms
    \\item Improve accuracy of predictions
    \\item Provide theoretical foundations
\\end{itemize}

\\section{Methodology}
Our approach combines theoretical analysis with empirical validation. The core equation governing our model is:

\\begin{equation}
    E = mc^2 + \\sum_{i=1}^{n} \\alpha_i x_i
\\end{equation}

This formulation allows us to capture both linear and non-linear relationships in the data.

\\section{Results}
Our experiments demonstrate significant improvements over baseline methods. Table \\ref{tab:results} summarizes the key findings.

\\section{Conclusion}
This research presents novel contributions to the field. Future work will explore extensions to more complex scenarios.

\\bibliographystyle{plain}
\\bibliography{references}

\\end{document}`,
                'introduction.tex': `\\section{Introduction}
The study of complex systems has emerged as a crucial area of research...`,
                'methodology.tex': `\\section{Methodology}
Our approach combines theoretical analysis with empirical validation...`,
                'results.tex': `\\section{Results}
Our experiments demonstrate significant improvements over baseline methods...`,
                'references.bib': `@article{smith2020,
    author = {Smith, John},
    title = {Foundational Principles of Complex Systems},
    journal = {Journal of Advanced Research},
    year = {2020},
    volume = {15},
    pages = {1--25}
}

@article{jones2021,
    author = {Jones, Emily and Williams, Mark},
    title = {Novel Approaches to System Analysis},
    journal = {International Review of Science},
    year = {2021},
    volume = {8},
    pages = {112--145}
}`
            },
            collaborators: [
                { id: 1, name: 'John Doe', initials: 'JD', color: 'var(--user-1)', isYou: true },
                { id: 2, name: 'Sarah Kim', initials: 'SK', color: 'var(--user-2)' },
                { id: 3, name: 'Michael Roberts', initials: 'MR', color: 'var(--user-3)' }
            ],
            chatMessages: [],
            comments: [],
            versions: []
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            const texEditor = document.getElementById('texEditor');
            texEditor.value = state.files['main.tex'];
            updatePreview();

            // Auto-save
            let saveTimeout;
            texEditor.addEventListener('input', () => {
                state.files[state.currentFile] = texEditor.value;
                document.getElementById('saveStatus').textContent = 'Saving...';
                document.querySelector('.doc-status').classList.remove('saved');
                
                clearTimeout(saveTimeout);
                saveTimeout = setTimeout(() => {
                    document.getElementById('saveStatus').textContent = 'All changes saved';
                    document.querySelector('.doc-status').classList.add('saved');
                    updatePreview();
                }, 1000);
            });

            // Line info
            texEditor.addEventListener('keyup', updateLineInfo);
            texEditor.addEventListener('click', updateLineInfo);

            // Word editor
            const wordContent = document.getElementById('wordContent');
            wordContent.addEventListener('input', () => {
                clearTimeout(saveTimeout);
                document.getElementById('saveStatus').textContent = 'Saving...';
                document.querySelector('.doc-status').classList.remove('saved');
                
                saveTimeout = setTimeout(() => {
                    document.getElementById('saveStatus').textContent = 'All changes saved';
                    document.querySelector('.doc-status').classList.add('saved');
                }, 1000);
            });

            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                if (e.ctrlKey || e.metaKey) {
                    switch (e.key) {
                        case 's':
                            e.preventDefault();
                            showToast('Document saved');
                            break;
                        case 'b':
                            e.preventDefault();
                            if (state.currentMode === 'latex') {
                                insertLatex('\\textbf{', '}');
                            } else {
                                formatWord('bold');
                            }
                            break;
                        case 'i':
                            e.preventDefault();
                            if (state.currentMode === 'latex') {
                                insertLatex('\\textit{', '}');
                            } else {
                                formatWord('italic');
                            }
                            break;
                    }
                }
            });
        });

        // Mode switching
        function switchMode(mode) {
            state.currentMode = mode;
            
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.mode === mode);
            });

            document.getElementById('latexEditor').style.display = mode === 'latex' ? 'flex' : 'none';
            document.getElementById('wordEditor').style.display = mode === 'word' ? 'flex' : 'none';
        }

        // File operations
        function openFile(filename) {
            state.currentFile = filename;
            
            document.querySelectorAll('.file-item').forEach(item => {
                item.classList.toggle('active', item.dataset.file === filename);
            });

            if (state.files[filename]) {
                document.getElementById('texEditor').value = state.files[filename];
                updatePreview();
            }
        }

        function createNewFile() {
            const name = prompt('Enter filename (e.g., chapter1.tex):');
            if (name) {
                state.files[name] = '';
                addFileToTree(name);
                openFile(name);
                showToast('File created: ' + name);
            }
        }

        function addFileToTree(filename) {
            const tree = document.querySelector('.folder-children');
            const icon = filename.endsWith('.bib') ? 
                `<svg class="file-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>` :
                `<svg class="file-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>`;
            
            const item = document.createElement('div');
            item.className = 'file-item';
            item.dataset.file = filename;
            item.onclick = () => openFile(filename);
            item.innerHTML = icon + filename;
            tree.appendChild(item);
        }

        // LaTeX functions
        function insertLatex(before, after) {
            const editor = document.getElementById('texEditor');
            const start = editor.selectionStart;
            const end = editor.selectionEnd;
            const text = editor.value;
            const selected = text.substring(start, end);
            
            editor.value = text.substring(0, start) + before + selected + after + text.substring(end);
            editor.focus();
            editor.setSelectionRange(start + before.length, start + before.length + selected.length);
            
            state.files[state.currentFile] = editor.value;
            updatePreview();
        }

        function updateLineInfo() {
            const editor = document.getElementById('texEditor');
            const text = editor.value.substring(0, editor.selectionStart);
            const lines = text.split('\n');
            const line = lines.length;
            const col = lines[lines.length - 1].length + 1;
            document.getElementById('lineInfo').textContent = `Line ${line}, Column ${col}`;
        }

        function updatePreview() {
            const tex = document.getElementById('texEditor').value;
            const preview = document.getElementById('texPreview');
            
            // Simple LaTeX to HTML conversion
            let html = tex
                // Remove preamble
                .replace(/\\documentclass\{[^}]*\}/g, '')
                .replace(/\\usepackage(\[[^\]]*\])?\{[^}]*\}/g, '')
                .replace(/\\bibliographystyle\{[^}]*\}/g, '')
                .replace(/\\bibliography\{[^}]*\}/g, '')
                
                // Title, author, date
                .replace(/\\title\{([^}]*)\}/g, '<h1 class="doc-title">$1</h1>')
                .replace(/\\author\{([^}]*)\}/g, '<p class="doc-author">$1</p>')
                .replace(/\\date\{\\today\}/g, '<p class="doc-date">' + new Date().toLocaleDateString() + '</p>')
                .replace(/\\maketitle/g, '')
                
                // Sections
                .replace(/\\section\{([^}]*)\}/g, '<h2>$1</h2>')
                .replace(/\\subsection\{([^}]*)\}/g, '<h3>$1</h3>')
                .replace(/\\subsubsection\{([^}]*)\}/g, '<h4>$1</h4>')
                
                // Abstract
                .replace(/\\begin\{abstract\}/g, '<div class="abstract"><strong>Abstract:</strong> ')
                .replace(/\\end\{abstract\}/g, '</div>')
                
                // Document
                .replace(/\\begin\{document\}/g, '')
                .replace(/\\end\{document\}/g, '')
                
                // Lists
                .replace(/\\begin\{itemize\}/g, '<ul>')
                .replace(/\\end\{itemize\}/g, '</ul>')
                .replace(/\\begin\{enumerate\}/g, '<ol>')
                .replace(/\\end\{enumerate\}/g, '</ol>')
                .replace(/\\item\s*/g, '<li>')
                
                // Text formatting
                .replace(/\\textbf\{([^}]*)\}/g, '<strong>$1</strong>')
                .replace(/\\textit\{([^}]*)\}/g, '<em>$1</em>')
                .replace(/\\underline\{([^}]*)\}/g, '<u>$1</u>')
                .replace(/\\emph\{([^}]*)\}/g, '<em>$1</em>')
                
                // Citations and references
                .replace(/\\cite\{([^}]*)\}/g, '<span class="citation">[$1]</span>')
                .replace(/\\ref\{([^}]*)\}/g, '<span class="ref">$1</span>')
                .replace(/\\label\{([^}]*)\}/g, '')
                
                // Tables
                .replace(/\\begin\{table\}[^]*?\\end\{table\}/gs, '<div class="table-placeholder">[Table]</div>')
                
                // Figures
                .replace(/\\begin\{figure\}[^]*?\\end\{figure\}/gs, '<div class="figure-placeholder">[Figure]</div>')
                
                // Comments
                .replace(/%.*$/gm, '')
                
                // Line breaks
                .replace(/\\\\/g, '<br>')
                .replace(/\\newline/g, '<br>')
                
                // Paragraphs
                .replace(/\n\n+/g, '</p><p>');

            // Handle math with KaTeX
            // Display math
            html = html.replace(/\\begin\{equation\}([\s\S]*?)\\end\{equation\}/g, (match, p1) => {
                try {
                    return '<div class="math-block">' + katex.renderToString(p1.trim(), { displayMode: true }) + '</div>';
                } catch (e) {
                    return '<div class="math-block math-error">' + p1 + '</div>';
                }
            });

            html = html.replace(/\\\[([\s\S]*?)\\\]/g, (match, p1) => {
                try {
                    return '<div class="math-block">' + katex.renderToString(p1.trim(), { displayMode: true }) + '</div>';
                } catch (e) {
                    return '<div class="math-block math-error">' + p1 + '</div>';
                }
            });

            // Inline math
            html = html.replace(/\$([^\$]+)\$/g, (match, p1) => {
                try {
                    return katex.renderToString(p1.trim(), { displayMode: false });
                } catch (e) {
                    return '<span class="math-error">' + p1 + '</span>';
                }
            });

            preview.innerHTML = '<p>' + html + '</p>';
        }

        function togglePreviewMode() {
            const panels = document.querySelector('.editor-panels');
            panels.classList.toggle('split');
        }

        // Word editor functions
        function formatWord(command, value = null) {
            document.execCommand(command, false, value);
            document.getElementById('wordContent').focus();
        }

        function insertLink() {
            const url = prompt('Enter URL:');
            if (url) {
                document.execCommand('createLink', false, url);
            }
        }

        // Panel tabs
        function switchPanelTab(tab) {
            document.querySelectorAll('.panel-tab').forEach(t => {
                t.classList.toggle('active', t.textContent.toLowerCase().includes(tab));
            });
            
            document.querySelectorAll('.panel-content').forEach(p => {
                p.classList.remove('active');
            });
            document.getElementById(tab + 'Panel').classList.add('active');
        }

        // Chat functions
        function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;

            const chatMessages = document.getElementById('chatMessages');
            const now = new Date();
            const time = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

            const messageHtml = `
                <div class="chat-message">
                    <div class="chat-avatar" style="background: var(--user-1)">JD</div>
                    <div class="chat-bubble">
                        <div class="chat-sender">John Doe</div>
                        <div class="chat-text">${escapeHtml(message)}</div>
                        <div class="chat-time">${time}</div>
                    </div>
                </div>
            `;

            chatMessages.insertAdjacentHTML('beforeend', messageHtml);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            input.value = '';

            // Simulate response
            setTimeout(() => simulateResponse(), 2000);
        }

        function handleChatKeypress(event) {
            if (event.key === 'Enter') {
                sendChatMessage();
            }
        }

        function simulateResponse() {
            const responses = [
                "Good point! I'll look into that.",
                "Makes sense. Let me update that section.",
                "I agree, we should revise the methodology.",
                "Thanks for the feedback!"
            ];

            const users = [
                { initials: 'SK', name: 'Sarah Kim', color: 'var(--user-2)' },
                { initials: 'MR', name: 'Michael Roberts', color: 'var(--user-3)' }
            ];

            const user = users[Math.floor(Math.random() * users.length)];
            const response = responses[Math.floor(Math.random() * responses.length)];
            const now = new Date();
            const time = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

            const chatMessages = document.getElementById('chatMessages');
            const messageHtml = `
                <div class="chat-message">
                    <div class="chat-avatar" style="background: ${user.color}">${user.initials}</div>
                    <div class="chat-bubble">
                        <div class="chat-sender">${user.name}</div>
                        <div class="chat-text">${response}</div>
                        <div class="chat-time">${time}</div>
                    </div>
                </div>
            `;

            chatMessages.insertAdjacentHTML('beforeend', messageHtml);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Comments
        function addComment() {
            const input = document.querySelector('.comment-input');
            const text = input.value.trim();
            
            if (!text) return;

            const commentsList = document.getElementById('commentsList');
            const commentHtml = `
                <div class="comment-card">
                    <div class="comment-header">
                        <div class="comment-avatar" style="background: var(--user-1)">JD</div>
                        <div class="comment-meta">
                            <div class="comment-author">John Doe</div>
                            <div class="comment-time">Just now</div>
                        </div>
                    </div>
                    <div class="comment-text">${escapeHtml(text)}</div>
                    <div class="comment-actions">
                        <button class="comment-action">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/>
                            </svg>
                            Reply
                        </button>
                        <button class="comment-action">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="20 6 9 17 4 12"/>
                            </svg>
                            Resolve
                        </button>
                    </div>
                </div>
            `;

            commentsList.insertAdjacentHTML('afterbegin', commentHtml);
            input.value = '';
            
            // Update count
            const count = document.getElementById('commentCount');
            count.textContent = parseInt(count.textContent) + 1;
            
            showToast('Comment added');
        }

        // Modal functions
        function showModal(type) {
            document.getElementById(type + 'Modal').classList.add('active');
        }

        function hideModal(type) {
            document.getElementById(type + 'Modal').classList.remove('active');
        }

        // Export
        function exportDocument() {
            const format = document.getElementById('exportFormat').value;
            
            if (format === 'tex') {
                downloadFile(state.files[state.currentFile], 'document.tex', 'text/plain');
            } else if (format === 'docx') {
                exportToDocx();
            } else if (format === 'html') {
                const html = document.getElementById('texPreview').innerHTML;
                downloadFile(html, 'document.html', 'text/html');
            } else if (format === 'md') {
                const md = latexToMarkdown(state.files[state.currentFile]);
                downloadFile(md, 'document.md', 'text/plain');
            }

            hideModal('export');
            showToast('Document exported as ' + format.toUpperCase());
        }

        async function exportToDocx() {
            const content = state.currentMode === 'latex' ? 
                document.getElementById('texPreview').innerText : 
                document.getElementById('wordContent').innerText;

            const doc = new docx.Document({
                sections: [{
                    properties: {},
                    children: content.split('\n\n').map(para => 
                        new docx.Paragraph({ text: para })
                    )
                }]
            });

            const blob = await docx.Packer.toBlob(doc);
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'document.docx';
            a.click();
            URL.revokeObjectURL(url);
        }

        function latexToMarkdown(tex) {
            return tex
                .replace(/\\section\{([^}]*)\}/g, '## $1')
                .replace(/\\subsection\{([^}]*)\}/g, '### $1')
                .replace(/\\textbf\{([^}]*)\}/g, '**$1**')
                .replace(/\\textit\{([^}]*)\}/g, '*$1*')
                .replace(/\\begin\{itemize\}/g, '')
                .replace(/\\end\{itemize\}/g, '')
                .replace(/\\item\s*/g, '- ')
                .replace(/\\begin\{document\}/g, '')
                .replace(/\\end\{document\}/g, '')
                .replace(/\\documentclass\{[^}]*\}/g, '')
                .replace(/\\usepackage(\[[^\]]*\])?\{[^}]*\}/g, '')
                .replace(/%.*$/gm, '');
        }

        function downloadFile(content, filename, type) {
            const blob = new Blob([content], { type: type });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
        }

        // File upload
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            
            if (file.name.endsWith('.docx')) {
                reader.onload = async (e) => {
                    const result = await mammoth.extractRawText({ arrayBuffer: e.target.result });
                    document.getElementById('wordContent').innerText = result.value;
                    switchMode('word');
                    hideModal('upload');
                    showToast('File uploaded: ' + file.name);
                };
                reader.readAsArrayBuffer(file);
            } else {
                reader.onload = (e) => {
                    state.files[file.name] = e.target.result;
                    addFileToTree(file.name);
                    openFile(file.name);
                    hideModal('upload');
                    showToast('File uploaded: ' + file.name);
                };
                reader.readAsText(file);
            }
        }

        // Utilities
        function copyLink() {
            navigator.clipboard.writeText('https://researchsync.io/doc/abc123');
            showToast('Link copied to clipboard');
        }

        function shareDocument() {
            hideModal('share');
            showToast('Invitation sent');
        }

        function toggleTheme() {
            document.body.toggleAttribute('data-theme');
            if (document.body.hasAttribute('data-theme')) {
                document.body.setAttribute('data-theme', 'dark');
            }
        }

        function showToast(message) {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.innerHTML = `
                <svg class="toast-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                    <polyline points="22 4 12 14.01 9 11.01"/>
                </svg>
                <span class="toast-message">${message}</span>
            `;
            container.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Close modals on click outside
        document.querySelectorAll('.modal-overlay').forEach(overlay => {
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    overlay.classList.remove('active');
                }
            });
        });
    </script>
</body>
</html>
